"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = require("babel-runtime/helpers/classCallCheck");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require("babel-runtime/helpers/createClass");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

////////////////////////////////////////////////////////////////////
//  Archontis Politis
//  archontis.politis@aalto.fi
//  David Poirier-Quinot
//  davipoir@ircam.fr
////////////////////////////////////////////////////////////////////
//
//  JSAmbisonics a JavaScript library for higher-order Ambisonics
//  The library implements Web Audio blocks that perform
//  typical ambisonic processing operations on audio signals.
//
////////////////////////////////////////////////////////////////////

///////////////////////////
/* HOA AMBISONIC DECODER */
///////////////////////////

var utils = require("./utils.js");

var decoder = function () {
    function decoder(audioCtx, order) {
        (0, _classCallCheck3.default)(this, decoder);


        // locals
        this.ctx = audioCtx;
        this.order = order;
        this.nCh = (order + 1) * (order + 1);
        this.nSpk = 0;
        this._decodingMatrix = [];
        this._spkSphPosArray = [];

        // Input and output nodes
        this.in = this.ctx.createChannelSplitter(this.nCh);
        this.out = this.ctx.createChannelMerger(1); // dummy

        // dummy init array
        this._spkSphPosArray = this._getDefaultSpkConfig(this.order);
        this._updateDecodeMtx(this._spkSphPosArray);
    }

    // spkSphPosArray in spherical coordinates: [ [azim1, elev1, dist1], ... [azimN, elevN, distN] ]


    (0, _createClass3.default)(decoder, [{
        key: "_updateDecodeMtx",


        // internal method to calculate Ambisonic decoding matrix and define new ambisonic gain nodes and values
        value: function _updateDecodeMtx(spkSphPosArray) {

            // update output
            this.nSpk = spkSphPosArray.length;
            this.out = this.ctx.createChannelMerger(this.nSpk);

            // get decoding matrix
            this._decodingMatrix = utils.getAmbisonicDecMtx(spkSphPosArray, this.order);

            // assign ambisonic gains to gain matrix + connect new graph
            this.mtxGain = new Array(this.nCh);
            for (var i = 0; i < this.nCh; i++) {
                this.mtxGain[i] = new Array(this.nSpk);
                for (var j = 0; j < this.nSpk; j++) {
                    // create / setup gain
                    var g = this.ctx.createGain();
                    g.gain.value = this._decodingMatrix[j][i];
                    // connect graph
                    this.in.connect(g, i, 0);
                    g.connect(this.out, 0, j);
                    // save to local
                    this.mtxGain[i][j] = g;
                }
            }
        }

        // get default speaker configuration for orders 1, 2, 3

    }, {
        key: "_getDefaultSpkConfig",
        value: function _getDefaultSpkConfig(order) {
            var spkSphPosArray = [];
            switch (order) {
                case 1:
                    // default first order: octahedron
                    spkSphPosArray = [[0, 0, 1], [90, 0, 1], [180, 0, 1], [270, 0, 1], [0, 90, 1], [0, -90, 1]];
                    break;
                case 2:
                    // default second order: icosahedron
                    spkSphPosArray = [[180.0000, -31.7161, 0.5878], [180.0000, 31.7161, 0.5878], [-121.7161, 0, 0.5878], [121.7161, 0, 0.5878], [-90.0000, -58.2839, 0.5878], [-90.0000, 58.2839, 0.5878], [90.0000, -58.2839, 0.5878], [90.0000, 58.2839, 0.5878], [-58.2839, 0, 0.5878], [58.2839, 0, 0.5878], [0, -31.7161, 0.5878], [0, 31.7161, 0.5878]];
                    break;
                case 3:
                    // default third order: dodecahedron
                    spkSphPosArray = [[-159.0931, 0, 0.5352], [159.0931, 0, 0.5352], [-135.0000, -35.2644, 0.5352], [-135.0000, 35.2644, 0.5352], [135.0000, -35.2644, 0.5352], [135.0000, 35.2644, 0.5352], [180.0000, -69.0931, 0.5352], [180.0000, 69.0931, 0.5352], [-90.0000, -20.9069, 0.5352], [-90.0000, 20.9069, 0.5352], [90.0000, -20.9069, 0.5352], [90.0000, 20.9069, 0.5352], [0, -69.0931, 0.5352], [0, 69.0931, 0.5352], [-45.0000, -35.2644, 0.5352], [-45.0000, 35.2644, 0.5352], [45.0000, -35.2644, 0.5352], [45.0000, 35.2644, 0.5352], [-20.9069, 0, 0.5352], [20.9069, 0, 0.5352]];
                    break;
                default:
                    console.error("unsupported default order:", order);
            }
            return spkSphPosArray;
        }
    }, {
        key: "speakerPos",
        set: function set(spkSphPosArray) {
            // set default array
            if (spkSphPosArray === undefined) {
                spkSphPosArray = this._getDefaultSpkConfig(this.order);
            }
            this._spkSphPosArray = spkSphPosArray;
            // discard old output
            this.out.disconnect();
            // update output / decode matrix
            this._updateDecodeMtx(spkSphPosArray);
        },
        get: function get() {
            return this._spkSphPosArray;
        }
    }]);
    return decoder;
}();

exports.default = decoder;
//# sourceMappingURL=data:application/json;base64,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dGVudCI6WyIvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gIEFyY2hvbnRpcyBQb2xpdGlzXG4vLyAgYXJjaG9udGlzLnBvbGl0aXNAYWFsdG8uZmlcbi8vICBEYXZpZCBQb2lyaWVyLVF1aW5vdFxuLy8gIGRhdmlwb2lyQGlyY2FtLmZyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy9cbi8vICBKU0FtYmlzb25pY3MgYSBKYXZhU2NyaXB0IGxpYnJhcnkgZm9yIGhpZ2hlci1vcmRlciBBbWJpc29uaWNzXG4vLyAgVGhlIGxpYnJhcnkgaW1wbGVtZW50cyBXZWIgQXVkaW8gYmxvY2tzIHRoYXQgcGVyZm9ybVxuLy8gIHR5cGljYWwgYW1iaXNvbmljIHByb2Nlc3Npbmcgb3BlcmF0aW9ucyBvbiBhdWRpbyBzaWduYWxzLlxuLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLyogSE9BIEFNQklTT05JQyBERUNPREVSICovXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxudmFyIHV0aWxzID0gcmVxdWlyZShcIi4vdXRpbHMuanNcIik7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIGRlY29kZXIge1xuXG4gICAgY29uc3RydWN0b3IoYXVkaW9DdHgsIG9yZGVyKSB7XG5cbiAgICAgICAgLy8gbG9jYWxzXG4gICAgICAgIHRoaXMuY3R4ID0gYXVkaW9DdHg7XG4gICAgICAgIHRoaXMub3JkZXIgPSBvcmRlcjtcbiAgICAgICAgdGhpcy5uQ2ggPSAob3JkZXIgKyAxKSAqIChvcmRlciArIDEpO1xuICAgICAgICB0aGlzLm5TcGsgPSAwO1xuICAgICAgICB0aGlzLl9kZWNvZGluZ01hdHJpeCA9IFtdO1xuICAgICAgICB0aGlzLl9zcGtTcGhQb3NBcnJheSA9IFtdO1xuXG4gICAgICAgIC8vIElucHV0IGFuZCBvdXRwdXQgbm9kZXNcbiAgICAgICAgdGhpcy5pbiA9IHRoaXMuY3R4LmNyZWF0ZUNoYW5uZWxTcGxpdHRlcih0aGlzLm5DaCk7XG4gICAgICAgIHRoaXMub3V0ID0gdGhpcy5jdHguY3JlYXRlQ2hhbm5lbE1lcmdlcigxKTsgLy8gZHVtbXlcblxuICAgICAgICAvLyBkdW1teSBpbml0IGFycmF5XG4gICAgICAgIHRoaXMuX3Nwa1NwaFBvc0FycmF5ID0gdGhpcy5fZ2V0RGVmYXVsdFNwa0NvbmZpZyh0aGlzLm9yZGVyKTtcbiAgICAgICAgdGhpcy5fdXBkYXRlRGVjb2RlTXR4KCB0aGlzLl9zcGtTcGhQb3NBcnJheSApO1xuICAgIH1cblxuICAgIC8vIHNwa1NwaFBvc0FycmF5IGluIHNwaGVyaWNhbCBjb29yZGluYXRlczogWyBbYXppbTEsIGVsZXYxLCBkaXN0MV0sIC4uLiBbYXppbU4sIGVsZXZOLCBkaXN0Tl0gXVxuICAgIHNldCBzcGVha2VyUG9zKHNwa1NwaFBvc0FycmF5KXtcbiAgICAgICAgLy8gc2V0IGRlZmF1bHQgYXJyYXlcbiAgICAgICAgaWYoIHNwa1NwaFBvc0FycmF5ID09PSB1bmRlZmluZWQgKXsgc3BrU3BoUG9zQXJyYXkgPSB0aGlzLl9nZXREZWZhdWx0U3BrQ29uZmlnKHRoaXMub3JkZXIpOyB9XG4gICAgICAgIHRoaXMuX3Nwa1NwaFBvc0FycmF5ID0gc3BrU3BoUG9zQXJyYXk7XG4gICAgICAgIC8vIGRpc2NhcmQgb2xkIG91dHB1dFxuICAgICAgICB0aGlzLm91dC5kaXNjb25uZWN0KCk7XG4gICAgICAgIC8vIHVwZGF0ZSBvdXRwdXQgLyBkZWNvZGUgbWF0cml4IFxuICAgICAgICB0aGlzLl91cGRhdGVEZWNvZGVNdHgoIHNwa1NwaFBvc0FycmF5ICk7XG4gICAgfVxuXG4gICAgZ2V0IHNwZWFrZXJQb3MoKXsgcmV0dXJuIHRoaXMuX3Nwa1NwaFBvc0FycmF5OyB9XG5cbiAgICAvLyBpbnRlcm5hbCBtZXRob2QgdG8gY2FsY3VsYXRlIEFtYmlzb25pYyBkZWNvZGluZyBtYXRyaXggYW5kIGRlZmluZSBuZXcgYW1iaXNvbmljIGdhaW4gbm9kZXMgYW5kIHZhbHVlc1xuICAgIF91cGRhdGVEZWNvZGVNdHgoc3BrU3BoUG9zQXJyYXkpe1xuICAgICAgICBcbiAgICAgICAgLy8gdXBkYXRlIG91dHB1dFxuICAgICAgICB0aGlzLm5TcGsgPSBzcGtTcGhQb3NBcnJheS5sZW5ndGg7XG4gICAgICAgIHRoaXMub3V0ID0gdGhpcy5jdHguY3JlYXRlQ2hhbm5lbE1lcmdlcih0aGlzLm5TcGspO1xuXG4gICAgICAgIC8vIGdldCBkZWNvZGluZyBtYXRyaXhcbiAgICAgICAgdGhpcy5fZGVjb2RpbmdNYXRyaXggPSB1dGlscy5nZXRBbWJpc29uaWNEZWNNdHgoc3BrU3BoUG9zQXJyYXksIHRoaXMub3JkZXIpO1xuXG4gICAgICAgIC8vIGFzc2lnbiBhbWJpc29uaWMgZ2FpbnMgdG8gZ2FpbiBtYXRyaXggKyBjb25uZWN0IG5ldyBncmFwaFxuICAgICAgICB0aGlzLm10eEdhaW4gPSBuZXcgQXJyYXkodGhpcy5uQ2gpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubkNoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMubXR4R2FpbltpXSA9IG5ldyBBcnJheSh0aGlzLm5TcGspO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLm5TcGs7IGorKykge1xuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSAvIHNldHVwIGdhaW5cbiAgICAgICAgICAgICAgICBsZXQgZyA9IHRoaXMuY3R4LmNyZWF0ZUdhaW4oKTtcbiAgICAgICAgICAgICAgICBnLmdhaW4udmFsdWUgPSB0aGlzLl9kZWNvZGluZ01hdHJpeFtqXVtpXTtcbiAgICAgICAgICAgICAgICAvLyBjb25uZWN0IGdyYXBoXG4gICAgICAgICAgICAgICAgdGhpcy5pbi5jb25uZWN0KGcsIGksIDApO1xuICAgICAgICAgICAgICAgIGcuY29ubmVjdCh0aGlzLm91dCwgMCwgaik7XG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0byBsb2NhbFxuICAgICAgICAgICAgICAgIHRoaXMubXR4R2FpbltpXVtqXSA9IGc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBnZXQgZGVmYXVsdCBzcGVha2VyIGNvbmZpZ3VyYXRpb24gZm9yIG9yZGVycyAxLCAyLCAzXG4gICAgX2dldERlZmF1bHRTcGtDb25maWcob3JkZXIpe1xuICAgICAgICBsZXQgc3BrU3BoUG9zQXJyYXkgPSBbXTtcbiAgICAgICAgc3dpdGNoKG9yZGVyKSB7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgLy8gZGVmYXVsdCBmaXJzdCBvcmRlcjogb2N0YWhlZHJvblxuICAgICAgICAgICAgICAgIHNwa1NwaFBvc0FycmF5ID0gWyBbMCwgMCwgMV0sIFs5MCwgMCwgMV0sIFsxODAsIDAsIDFdLCBbMjcwLCAwLCAxXSwgWzAsIDkwLCAxXSwgWzAsIC05MCwgMV0gXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0IHNlY29uZCBvcmRlcjogaWNvc2FoZWRyb25cbiAgICAgICAgICAgICAgICBzcGtTcGhQb3NBcnJheSA9IFtcbiAgICAgICAgICAgICAgICAgICAgWyAgMTgwLjAwMDAsICAtMzEuNzE2MSwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgMTgwLjAwMDAsICAgMzEuNzE2MSwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAtMTIxLjcxNjEsICAgICAgICAgMCwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgMTIxLjcxNjEsICAgICAgICAgMCwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgLTkwLjAwMDAsICAtNTguMjgzOSwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgLTkwLjAwMDAsICAgNTguMjgzOSwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgIDkwLjAwMDAsICAtNTguMjgzOSwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgIDkwLjAwMDAsICAgNTguMjgzOSwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgLTU4LjI4MzksICAgICAgICAgMCwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgIDU4LjI4MzksICAgICAgICAgMCwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgICAgICAgIDAsICAtMzEuNzE2MSwgICAgMC41ODc4XSxcbiAgICAgICAgICAgICAgICAgICAgWyAgICAgICAgIDAsICAgMzEuNzE2MSwgICAgMC41ODc4XV07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgLy8gZGVmYXVsdCB0aGlyZCBvcmRlcjogZG9kZWNhaGVkcm9uXG4gICAgICAgICAgICAgICAgc3BrU3BoUG9zQXJyYXkgPSBbXG4gICAgICAgICAgICAgICAgICAgIFsgLTE1OS4wOTMxLCAgICAgICAgIDAsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIDE1OS4wOTMxLCAgICAgICAgIDAsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgLTEzNS4wMDAwLCAgLTM1LjI2NDQsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgLTEzNS4wMDAwLCAgIDM1LjI2NDQsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIDEzNS4wMDAwLCAgLTM1LjI2NDQsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIDEzNS4wMDAwLCAgIDM1LjI2NDQsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIDE4MC4wMDAwLCAgLTY5LjA5MzEsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIDE4MC4wMDAwLCAgIDY5LjA5MzEsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIC05MC4wMDAwLCAgLTIwLjkwNjksICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIC05MC4wMDAwLCAgIDIwLjkwNjksICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgICA5MC4wMDAwLCAgLTIwLjkwNjksICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgICA5MC4wMDAwLCAgIDIwLjkwNjksICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgICAgICAgICAwLCAgLTY5LjA5MzEsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgICAgICAgICAwLCAgIDY5LjA5MzEsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIC00NS4wMDAwLCAgLTM1LjI2NDQsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIC00NS4wMDAwLCAgIDM1LjI2NDQsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgICA0NS4wMDAwLCAgLTM1LjI2NDQsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgICA0NS4wMDAwLCAgIDM1LjI2NDQsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgIC0yMC45MDY5LCAgICAgICAgIDAsICAgIDAuNTM1Ml0sXG4gICAgICAgICAgICAgICAgICAgIFsgICAyMC45MDY5LCAgICAgICAgIDAsICAgIDAuNTM1Ml1dO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwidW5zdXBwb3J0ZWQgZGVmYXVsdCBvcmRlcjpcIiwgb3JkZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzcGtTcGhQb3NBcnJheVxuICAgIH1cbn1cbiJdfQ==